<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EduVillage | Teacher Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family: Arial, sans-serif;}
body{display:flex;height:100vh;background: linear-gradient(135deg, #6e45e2, #88d3ce);}
.sidebar{width:240px;background:#472e9f;color:white;padding:20px;}
.sidebar h2{text-align:center;margin-bottom:30px;font-family:"Lucida Handwriting";}
.sidebar button{width:100%;padding:12px;margin:6px 0;border:none;background:#755dca;color:black;cursor:pointer;text-align:left;border-radius:5px;transition:0.3s;}
.sidebar button:hover{background:#2a165f;color:white;}
.main{flex:1;padding:30px;overflow-y:auto;}
.section{display:none;background:linear-gradient(135deg,#baa9c5,#88d3ce);padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,0.2);}
.section.active{display:block;}
input, textarea{width:100%;padding:10px;margin:8px 0;border-radius:5px;border:1px solid #444;}
button.action{padding:8px 15px;background:#755dca;border:none;border-radius:5px;cursor:pointer;}
button.action:hover{background:#2a165f;color:white;}
h3{margin-bottom:10px;}
</style>
</head>
<body>

<div class="sidebar">
    <h2>EduVillage</h2>
    <button onclick="showSection('profile')">Profile</button>
    <button onclick="showSection('courses')">Manage Courses</button>
    <button onclick="showSection('assignment')">Create Assignment</button>
    <button onclick="showSection('notes')">Upload Notes</button>
    <button onclick="showSection('students')">View Students</button>
    <button onclick="logout()">Logout</button>
</div>

<div class="main">
    <!-- PROFILE -->
    <div id="profile" class="section active">
        <h3>Teacher Profile</h3>
        <p><b>Name:</b> <span id="teacherName"></span></p>
        <p><b>Email:</b> <span id="teacherEmail"></span></p>
    </div>

    <!-- COURSES -->
    <div id="courses" class="section">
        <h3>Manage Courses</h3>
        <input type="text" id="courseName" placeholder="Course Name">
        <button class="action" onclick="addCourse()">Add Course</button>
        <ul id="courseList"></ul>
    </div>

    <!-- ASSIGNMENTS -->
    <div id="assignment" class="section">
        <h3>Create Assignment</h3>
        <input type="text" id="assignmentTitle" placeholder="Assignment Title">
        <textarea id="assignmentDesc" rows="3" placeholder="Assignment Description"></textarea>
        <button class="action" onclick="addAssignment()">Add Assignment</button>
        <ul id="assignmentList"></ul>
    </div>

    <!-- NOTES -->
    <div id="notes" class="section">
        <h3>Upload Notes</h3>
        <textarea id="notesText" rows="4" placeholder="Enter notes content"></textarea>
        <button class="action" onclick="saveNotes()">Save Notes</button>
    </div>

    <!-- STUDENTS -->
    <div id="students" class="section">
        <h3>Students List</h3>
        <ul id="studentList"></ul>
    </div>
</div>

<script>
/* SECTION SWITCH */
function showSection(id){
    document.querySelectorAll('.section').forEach(sec=>sec.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

/* LOGOUT */
function logout(){
    localStorage.clear();
    window.location.href = "login_register.html";
}

/* LOAD TEACHER DATA */
document.getElementById("teacherName").innerText = localStorage.getItem("teacherName") || "Teacher";
document.getElementById("teacherEmail").innerText = localStorage.getItem("teacherEmail") || "Not Available";

/* COURSES */
function addCourse(){
    let name = document.getElementById("courseName").value;
    if(!name){alert("Enter course name"); return;}
    let li = document.createElement("li");
    li.innerText = name;
    document.getElementById("courseList").appendChild(li);
    document.getElementById("courseName").value = "";
}

/* ASSIGNMENTS */
function addAssignment(){
    let title = document.getElementById("assignmentTitle").value;
    let desc = document.getElementById("assignmentDesc").value;
    if(!title){alert("Enter assignment title"); return;}
    let li = document.createElement("li");
    li.innerText = title + (desc? " – " + desc : "");
    document.getElementById("assignmentList").appendChild(li);
    document.getElementById("assignmentTitle").value = "";
    document.getElementById("assignmentDesc").value = "";
}

/* NOTES */
function saveNotes(){
    let notes = document.getElementById("notesText").value;
    if(!notes){alert("Enter notes"); return;}
    localStorage.setItem("teacherNotes", notes);
    alert("Notes saved successfully!");
    document.getElementById("notesText").value = "";
}

/* LOAD STUDENTS DYNAMICALLY */
async function loadStudents(){
    try {
        const res = await fetch("http://localhost:3000/getStudents");
        const data = await res.json();
        const ul = document.getElementById("studentList");
        ul.innerHTML = "";
        if(data.students && data.students.length > 0){
            data.students.forEach(student=>{
                const li = document.createElement("li");
                li.innerText = `${student.fullName} – ${student.username}`;
                ul.appendChild(li);
            });
        } else {
            const li = document.createElement("li");
            li.innerText = "No students registered yet.";
            ul.appendChild(li);
        }
    } catch(err){
        console.error(err);
        document.getElementById("studentList").innerHTML = "<li>Failed to load students</li>";
    }
}

/* LOAD DASHBOARD DATA */
window.addEventListener("DOMContentLoaded", ()=>{
    // Load notes if saved
    if(localStorage.getItem("teacherNotes"))
        document.getElementById("notesText").value = localStorage.getItem("teacherNotes");

    // Load students
    if(document.getElementById("studentList")){
        loadStudents();
    }
});
</script>
</body>
</html>
