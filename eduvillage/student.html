<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EduVillage | Student Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family: Arial, sans-serif;}
body{display:flex;height:100vh;background: linear-gradient(135deg, #6e45e2, #88d3ce);}
.sidebar{width:240px;background: #472e9f;color:white;padding:20px;}
.sidebar h2{text-align:center;margin-bottom:30px;font-family: "Lucida Handwriting";}
.sidebar button{width:100%;padding:12px;margin:6px 0;border:none;background:#755dca;color:black;cursor:pointer;text-align:left;border-radius:5px;transition:0.3s;}
.sidebar button:hover{background:#2a165f;color:white;}
.sidebar button.active-btn{background:#2a165f;color:white;}
.main{flex:1;padding:30px;overflow-y:auto;}
.section{display:none;background: linear-gradient(135deg, #baa9c5, #88d3ce);padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.2);}
.section.active{display:block;}
.section button{padding:8px 15px;background:#755dca;border:none;border-radius:5px;cursor:pointer;}
.section button:hover{background:#2a165f;color:white;}
h2{margin-bottom:10px;}
</style>
</head>

<body>
<div class="sidebar">
    <h2>EduVillage</h2>
    <button onclick="showSection('profile')" id="btn-profile">Profile</button>
    <button onclick="showSection('openCourses')" id="btn-courses">Courses</button>
    <button onclick="showSection('assignment')" id="btn-assignment">Assignments</button>
    <button onclick="showSection('notes')" id="btn-notes">Notes</button>
    <button onclick="showSection('leaderboard')" id="btn-leaderboard">Leaderboard</button>
    <button onclick="logout()">Logout</button>
</div>

<div class="main">

<!-- PROFILE -->
<div id="profile" class="section active">
    <h2>Student Profile</h2>
    <p><b>Name:</b> <span id="studentName"></span></p>
    <p><b>Email:</b> <span id="studentEmail"></span></p>
</div>

<!-- COURSES -->
<div id="openCourses" class="section">
    <h2>My Courses</h2>

    <button onclick="goToCourses()">Browse Courses</button>
    <br><br>

    <ul id="studentCourseList">
        <li>No courses enrolled yet</li>
    </ul>
</div>

<!-- ASSIGNMENTS -->
<div id="assignment" class="section">
    <h2>Assignments</h2>
    <ul id="assignmentList"></ul>
</div>

<!-- NOTES -->
<div id="notes" class="section">
    <h2>Notes</h2>
    <ul id="notesList"></ul>
</div>

<!-- LEADERBOARD -->
<div id="leaderboard" class="section">
    <h2>Leaderboard</h2>
    <ol id="leaderboardList"></ol>
</div>

</div>

<script>
/* ================= SECTION SWITCH ================= */
function showSection(id){
    document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
    document.getElementById(id).classList.add('active');

    document.querySelectorAll('.sidebar button').forEach(btn => btn.classList.remove('active-btn'));
    const btn = document.getElementById("btn-" + id);
    if(btn) btn.classList.add('active-btn');

    if(id === "openCourses"){
        loadStudentCourses();
    }
}

/* ================= PROFILE ================= */
document.getElementById("studentName").innerText =
    localStorage.getItem("studentName") || "Student";
document.getElementById("studentEmail").innerText =
    localStorage.getItem("studentEmail") || "Not Available";

/* ================= COURSES ================= */
function loadStudentCourses(){
    const list = document.getElementById("studentCourseList");
    const courses = JSON.parse(localStorage.getItem("enrolledCourses")) || [];

    list.innerHTML = "";

    if(courses.length === 0){
        list.innerHTML = "<li>No courses enrolled yet</li>";
        return;
    }

    courses.forEach(course => {
        const li = document.createElement("li");
        li.innerText = "âœ” " + course;
        list.appendChild(li);
    });
}

function goToCourses(){
    window.location.href = "courses.html";
}

/* ================= ASSIGNMENTS ================= */
async function loadAssignments(){
    const ul = document.getElementById("assignmentList");
    const studentId = localStorage.getItem("studentId");

    if(!studentId){
        ul.innerHTML = "<li>Please login again</li>";
        return;
    }

    ul.innerHTML = "<li>Loading assignments...</li>";

    try {
        const res = await fetch(`http://localhost:3000/student/assignments/${studentId}`);
        const data = await res.json();
        ul.innerHTML = "";

        if(!data.success || data.assignments.length === 0){
            ul.innerHTML = "<li>No assignments for your courses</li>";
            return;
        }

        data.assignments.forEach(a=>{
            const li = document.createElement("li");
            li.innerHTML = `
                <b>${a.title}</b> (${a.course_name})<br>
                ${a.description}<br>
                <small>Teacher: ${a.teacher_name}</small>
            `;
            ul.appendChild(li);
        });

    } catch(err){
        ul.innerHTML = "<li>Server error loading assignments</li>";
    }
}


/* ================= NOTES ================= */
async function loadNotes(){
    const ul = document.getElementById("notesList");
    ul.innerHTML = "<li>Loading notes...</li>";
    const res = await fetch("http://localhost:3000/notes");
    const data = await res.json();
    ul.innerHTML = "";
    if(data.success){
        data.notes.forEach(n=>{
            const li = document.createElement("li");
            li.innerHTML = `<b>${n.teacher_name}</b> - ${n.content}`;
            ul.appendChild(li);
        });
    }
}

/* ================= LEADERBOARD ================= */
function loadLeaderboard(){
    const list = document.getElementById("leaderboardList");
    list.innerHTML = "";
    ["Alice","Bob","Charlie"].forEach((n,i)=>{
        const li = document.createElement("li");
        li.innerText = `${n} - ${95-i*5}`;
        list.appendChild(li);
    });
}

/* ================= LOGOUT ================= */
function logout(){
    localStorage.clear();
    window.location.href = "login_register.html";
}

/* ================= INIT ================= */
window.onload = ()=>{
    loadAssignments();
    loadNotes();
    loadLeaderboard();
};
</script>

</body>
</html>
